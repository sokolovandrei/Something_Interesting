# -*- coding: utf-8 -*-
import csv
from pprint import pprint
import ipaddress
import re
import sys
import os
from netmiko import ConnectHandler, NetMikoAuthenticationException

# export NET_TEXTFSM=/home/andrey_s/scripts/Something_Interesting/ntc-templates/templates
# set NET_TEXTFSM=C:\Study\Python_New\ntc-templates-master\templates

user = "greennet_hw"
password = "Gree@_978nnet+"
ip_addr = ['172.24.32.10',
'172.24.32.11',
'172.24.32.129',
'172.24.32.13',
'172.24.32.130',
'172.24.32.131',
'172.24.32.132',
'172.24.32.133',
'172.24.32.14',
'172.24.32.15',
'172.24.32.193',
'172.24.32.194',
'172.24.32.195',
'172.24.32.196',
'172.24.32.197',
'172.24.32.198',
'172.24.32.199',
'172.24.32.200',
'172.24.32.201',
'172.24.32.203',
'172.24.32.205',
'172.24.32.206',
'172.24.32.207',
'172.24.32.209',
'172.24.32.210',
'172.24.32.211',
'172.24.32.212',
'172.24.32.213',
'172.24.32.214',
'172.24.32.217',
'172.24.32.3',
'172.24.32.4',
'172.24.32.6',
'172.24.32.65',
'172.24.32.66',
'172.24.32.67',
'172.24.32.68',
'172.24.32.69',
'172.24.32.7',
'172.24.32.70',
'172.24.32.71',
'172.24.32.8',
'172.24.32.9',
'172.24.33.1',
'172.24.33.10',
'172.24.33.11',
'172.24.33.12',
'172.24.33.129',
'172.24.33.130',
'172.24.33.131',
'172.24.33.134',
'172.24.33.135',
'172.24.33.136',
'172.24.33.138',
'172.24.33.139',
'172.24.33.14',
'172.24.33.140',
'172.24.33.193',
'172.24.33.194',
'172.24.33.195',
'172.24.33.196',
'172.24.33.197',
'172.24.33.198',
'172.24.33.2',
'172.24.33.200',
'172.24.33.4',
'172.24.33.5',
'172.24.33.6',
'172.24.33.65',
'172.24.33.66',
'172.24.33.67',
'172.24.33.68',
'172.24.33.69',
'172.24.33.7',
'172.24.33.71',
'172.24.33.72',
'172.24.33.73',
'172.24.33.74',
'172.24.33.75',
'172.24.33.76',
'172.24.33.77',
'172.24.33.78',
'172.24.33.79',
'172.24.33.83',
'172.24.33.84',
'172.24.33.85',
'172.24.33.86',
'172.24.34.1',
'172.24.34.10',
'172.24.34.11',
'172.24.34.12',
'172.24.34.129',
'172.24.34.13',
'172.24.34.130',
'172.24.34.132',
'172.24.34.133',
'172.24.34.134',
'172.24.34.135',
'172.24.34.14',
'172.24.34.15',
'172.24.34.193',
'172.24.34.194',
'172.24.34.195',
'172.24.34.196',
'172.24.34.197',
'172.24.34.198',
'172.24.34.199',
'172.24.34.2',
'172.24.34.200',
'172.24.34.201',
'172.24.34.202',
'172.24.34.203',
'172.24.34.204',
'172.24.34.205',
'172.24.34.207',
'172.24.34.208',
'172.24.34.209',
'172.24.34.210',
'172.24.34.211',
'172.24.34.212',
'172.24.34.213',
'172.24.34.214',
'172.24.34.215',
'172.24.34.216',
'172.24.34.3',
'172.24.34.4',
'172.24.34.5',
'172.24.34.6',
'172.24.34.65',
'172.24.34.66',
'172.24.34.67',
'172.24.34.68',
'172.24.34.69',
'172.24.34.7',
'172.24.34.70',
'172.24.34.71',
'172.24.34.72',
'172.24.34.74',
'172.24.34.75',
'172.24.34.76',
'172.24.34.77',
'172.24.34.78',
'172.24.34.79',
'172.24.34.8',
'172.24.34.9',
'172.24.35.1',
'172.24.35.10',
'172.24.35.11',
'172.24.35.12',
'172.24.35.134',
'172.24.35.135',
'172.24.35.136',
'172.24.35.14',
'172.24.35.140',
'172.24.35.142',
'172.24.35.143',
'172.24.35.144',
'172.24.35.145',
'172.24.35.148',
'172.24.35.15',
'172.24.35.151',
'172.24.35.155',
'172.24.35.156',
'172.24.35.157',
'172.24.35.17',
'172.24.35.18',
'172.24.35.19',
'172.24.35.193',
'172.24.35.194',
'172.24.35.198',
'172.24.35.199',
'172.24.35.2',
'172.24.35.200',
'172.24.35.201',
'172.24.35.202',
'172.24.35.203',
'172.24.35.204',
'172.24.35.205',
'172.24.35.206',
'172.24.35.207',
'172.24.35.22',
'172.24.35.24',
'172.24.35.27',
'172.24.35.28',
'172.24.35.29',
'172.24.35.3',
'172.24.35.30',
'172.24.35.31',
'172.24.35.32',
'172.24.35.33',
'172.24.35.34',
'172.24.35.35',
'172.24.35.36',
'172.24.35.37',
'172.24.35.4',
'172.24.35.5',
'172.24.35.6',
'172.24.35.65',
'172.24.35.66',
'172.24.35.67',
'172.24.35.68',
'172.24.35.7',
'172.24.35.71',
'172.24.35.72',
'172.24.35.73',
'172.24.35.74',
'172.24.35.75',
'172.24.35.8',
'172.24.35.9',
'172.24.36.1',
'172.24.36.10',
'172.24.36.11',
'172.24.36.129',
'172.24.36.130',
'172.24.36.134',
'172.24.36.136',
'172.24.36.14',
'172.24.36.143',
'172.24.36.144',
'172.24.36.145',
'172.24.36.147',
'172.24.36.148',
'172.24.36.149',
'172.24.36.15',
'172.24.36.152',
'172.24.36.153',
'172.24.36.154',
'172.24.36.156',
'172.24.36.158',
'172.24.36.16',
'172.24.36.17',
'172.24.36.18',
'172.24.36.193',
'172.24.36.195',
'172.24.36.196',
'172.24.36.197',
'172.24.36.198',
'172.24.36.199',
'172.24.36.2',
'172.24.36.200',
'172.24.36.201',
'172.24.36.202',
'172.24.36.203',
'172.24.36.204',
'172.24.36.205',
'172.24.36.207',
'172.24.36.209',
'172.24.36.211',
'172.24.36.212',
'172.24.36.214',
'172.24.36.215',
'172.24.36.216',
'172.24.36.217',
'172.24.36.218',
'172.24.36.219',
'172.24.36.4',
'172.24.36.5',
'172.24.36.65',
'172.24.36.66',
'172.24.36.67',
'172.24.36.68',
'172.24.36.70',
'172.24.36.72',
'172.24.36.73',
'172.24.36.74',
'172.24.36.77',
'172.24.36.78',
'172.24.36.79',
'172.24.36.81',
'172.24.36.82',
'172.24.36.84',
'172.24.36.85',
'172.24.36.86',
'172.24.36.87',
'172.24.36.88',
'172.24.36.89',
'172.24.36.9',
'172.24.36.90',
'172.24.36.91',
'172.24.36.92',
'172.24.37.11',
'172.24.37.12',
'172.24.37.129',
'172.24.37.130',
'172.24.37.131',
'172.24.37.132',
'172.24.37.133',
'172.24.37.134',
'172.24.37.135',
'172.24.37.136',
'172.24.37.137',
'172.24.37.138',
'172.24.37.139',
'172.24.37.140',
'172.24.37.141',
'172.24.37.142',
'172.24.37.143',
'172.24.37.144',
'172.24.37.145',
'172.24.37.146',
'172.24.37.147',
'172.24.37.148',
'172.24.37.149',
'172.24.37.150',
'172.24.37.151',
'172.24.37.152',
'172.24.37.153',
'172.24.37.154',
'172.24.37.155',
'172.24.37.156',
'172.24.37.158',
'172.24.37.159',
'172.24.37.16',
'172.24.37.193',
'172.24.37.194',
'172.24.37.195',
'172.24.37.196',
'172.24.37.197',
'172.24.37.198',
'172.24.37.199',
'172.24.37.200',
'172.24.37.201',
'172.24.37.202',
'172.24.37.3',
'172.24.37.4',
'172.24.37.6',
'172.24.37.65',
'172.24.37.66',
'172.24.37.67',
'172.24.37.68',
'172.24.37.69',
'172.24.37.7',
'172.24.37.70',
'172.24.37.71',
'172.24.37.72',
'172.24.37.73',
'172.24.37.74',
'172.24.37.75',
'172.24.37.76',
'172.24.37.78',
'172.24.37.79',
'172.24.37.8',
'172.24.37.80',
'172.24.37.81',
'172.24.37.82',
'172.24.37.83',
'172.24.37.9',
'172.24.38.129',
'172.24.38.65',
'172.24.38.66',
'172.24.38.67',
'172.24.38.69',
'172.24.38.70',
'172.24.38.71',
'172.24.38.72',
'172.24.38.73',
'172.24.38.74',
'172.24.38.75',
'172.24.38.76',
'172.24.38.77',
'172.24.38.78',
'172.24.38.79',
'172.24.38.80',
'172.24.38.81',
'172.24.38.82',
'172.24.38.83',
'172.24.38.84',
'172.24.38.87',
'172.24.38.88',
'172.24.38.90',
]
ip_addr_x = ['172.24.33.14',
'172.24.33.140',
'172.24.33.193',
'172.24.33.194',
'172.24.33.195',
'172.24.33.196',
'172.24.33.197',
'172.24.33.198',
'172.24.33.2',
'172.24.33.200',
'172.24.33.4',
'172.24.33.5',
'172.24.33.6',
'172.24.33.65',
'172.24.33.66',
'172.24.33.67',
'172.24.33.68',
'172.24.33.69',
'172.24.33.7',
'172.24.33.71',
'172.24.33.72',
'172.24.33.73',
'172.24.33.74',
'172.24.33.75',
'172.24.33.76',
'172.24.33.77',
'172.24.33.78',
'172.24.33.79',
'172.24.33.83',
'172.24.33.84',
'172.24.33.85',
'172.24.33.86',
'172.24.34.1',
'172.24.34.10',
'172.24.34.11',
'172.24.34.12',
'172.24.34.129',
'172.24.34.13',
'172.24.34.130',
'172.24.34.132',
'172.24.34.133',
'172.24.34.134',
'172.24.34.135',
'172.24.34.14',
'172.24.34.15',]
ip_addr_3 = ['172.24.34.10',
'172.24.34.11',
'172.24.34.12',
'172.24.34.129',
'172.24.34.13',
'172.24.34.130',
'172.24.34.132',
'172.24.34.133',
'172.24.34.134',
'172.24.34.135',
'172.24.34.14',
'172.24.34.15',
'172.24.34.193',
'172.24.34.194',
'172.24.34.195',
'172.24.34.196',
'172.24.34.197',
'172.24.34.198',
'172.24.34.199',
'172.24.34.2',
'172.24.34.200',
'172.24.34.201',
'172.24.34.202',
'172.24.34.203',
'172.24.34.204',
'172.24.34.205',
'172.24.34.207',
'172.24.34.208',
'172.24.34.209',
'172.24.34.210',
'172.24.34.211',
'172.24.34.212',
'172.24.34.213',
'172.24.34.214',
'172.24.34.215',
'172.24.34.216',
'172.24.34.3',
'172.24.34.4',
'172.24.34.5',
'172.24.34.6',
'172.24.34.65',
'172.24.34.66',
'172.24.34.67',
'172.24.34.68',
'172.24.34.69',
'172.24.34.7',
'172.24.34.70',
'172.24.34.71',
'172.24.34.72',
'172.24.34.74',
'172.24.34.75',
'172.24.34.76',
'172.24.34.77',
'172.24.34.78',
'172.24.34.79',
'172.24.34.8',
'172.24.34.9',
'172.24.35.1',
'172.24.35.10',
'172.24.35.11',
'172.24.35.12',
'172.24.35.134',
'172.24.35.135',
'172.24.35.136',
'172.24.35.14',
'172.24.35.140',
'172.24.35.142',
'172.24.35.143',
'172.24.35.144',
'172.24.35.145',
'172.24.35.148',
'172.24.35.15',
'172.24.35.151',
'172.24.35.155',
'172.24.35.156',
'172.24.35.157',
'172.24.35.17',
'172.24.35.18',
'172.24.35.19',
'172.24.35.193',
'172.24.35.194',
'172.24.35.198',
'172.24.35.199',
'172.24.35.2',
'172.24.35.200',
'172.24.35.201',
'172.24.35.202',
'172.24.35.203',
'172.24.35.204',
'172.24.35.205',
'172.24.35.206',
'172.24.35.207',
'172.24.35.22',
'172.24.35.24',
'172.24.35.27',
'172.24.35.28',
'172.24.35.29',
'172.24.35.3',
'172.24.35.30',
'172.24.35.31',
'172.24.35.32',
'172.24.35.33',
'172.24.35.34',
'172.24.35.35',
'172.24.35.36',
'172.24.35.37',
'172.24.35.4',
'172.24.35.5',
'172.24.35.6',
'172.24.35.65',
'172.24.35.66',
'172.24.35.67',
'172.24.35.68',
'172.24.35.7',
'172.24.35.71',
'172.24.35.72',
'172.24.35.73',
'172.24.35.74',
'172.24.35.75',
'172.24.35.8',
'172.24.35.9',
'172.24.36.1',
'172.24.36.10',
'172.24.36.11',
'172.24.36.129',
'172.24.36.130',
'172.24.36.134',
'172.24.36.136',
'172.24.36.14',
'172.24.36.143',
'172.24.36.144',
'172.24.36.145',
'172.24.36.147',
'172.24.36.148',
'172.24.36.149',
'172.24.36.15',
'172.24.36.152',
'172.24.36.153',
'172.24.36.154',
'172.24.36.156',
'172.24.36.158',
'172.24.36.16',
'172.24.36.17',
'172.24.36.18',
'172.24.36.193',
'172.24.36.195',
'172.24.36.196',
'172.24.36.197',
'172.24.36.198',
'172.24.36.199',
'172.24.36.2',
'172.24.36.200',
'172.24.36.201',
'172.24.36.202',
'172.24.36.203',
'172.24.36.204',
'172.24.36.205',
'172.24.36.207',
'172.24.36.209',
'172.24.36.211',
'172.24.36.212',
'172.24.36.214',
'172.24.36.215',
'172.24.36.216',
'172.24.36.217',
'172.24.36.218',
'172.24.36.219',
'172.24.36.4',
'172.24.36.5',
'172.24.36.65',
'172.24.36.66',
'172.24.36.67',
'172.24.36.68',
'172.24.36.70',
'172.24.36.72',
'172.24.36.73',
'172.24.36.74',
'172.24.36.77',
'172.24.36.78',
'172.24.36.79',
'172.24.36.81',
'172.24.36.82',
'172.24.36.84',
'172.24.36.85',
'172.24.36.86',
'172.24.36.87',
'172.24.36.88',
'172.24.36.89',
'172.24.36.9',
'172.24.36.90',
'172.24.36.91',
'172.24.36.92',
'172.24.37.11',
'172.24.37.12',
'172.24.37.129',
'172.24.37.130',
'172.24.37.131',
'172.24.37.132',
'172.24.37.133',
'172.24.37.134',
'172.24.37.135',
'172.24.37.136',
'172.24.37.137',
'172.24.37.138',
'172.24.37.139',
'172.24.37.140',
'172.24.37.141',
'172.24.37.142',
'172.24.37.143',
'172.24.37.144',
'172.24.37.145',
'172.24.37.146',
'172.24.37.147',
'172.24.37.148',
'172.24.37.149',
'172.24.37.150',
'172.24.37.151',
'172.24.37.152',
'172.24.37.153',
'172.24.37.154',
'172.24.37.155',
'172.24.37.156',
'172.24.37.158',
'172.24.37.159',
'172.24.37.16',
'172.24.37.193',
'172.24.37.194',
'172.24.37.195',
'172.24.37.196',
'172.24.37.197',
'172.24.37.198',
'172.24.37.199',
'172.24.37.200',
'172.24.37.201',
'172.24.37.202',
'172.24.37.3',
'172.24.37.4',
'172.24.37.6',
'172.24.37.65',
'172.24.37.66',
'172.24.37.67',
'172.24.37.68',
'172.24.37.69',
'172.24.37.7',
'172.24.37.70',
'172.24.37.71',
'172.24.37.72',
'172.24.37.73',
'172.24.37.74',
'172.24.37.75',
'172.24.37.76',
'172.24.37.78',
'172.24.37.79',
'172.24.37.8',
'172.24.37.80',
'172.24.37.81',
'172.24.37.82',
'172.24.37.83',
'172.24.37.9',
'172.24.38.129',
'172.24.38.65',
'172.24.38.66',
'172.24.38.67',
'172.24.38.69',
'172.24.38.70',
'172.24.38.71',
'172.24.38.72',
'172.24.38.73',
'172.24.38.74',
'172.24.38.75',
'172.24.38.76',
'172.24.38.77',
'172.24.38.78',
'172.24.38.79',
'172.24.38.80',
'172.24.38.81',
'172.24.38.82',
'172.24.38.83',
'172.24.38.84',
'172.24.38.87',
'172.24.38.88',
'172.24.38.90',]
ip_addr_4 = ['172.24.34.2',
'172.24.34.200',
'172.24.34.201',
'172.24.34.202',
'172.24.34.203',
'172.24.34.204',
'172.24.34.205',
'172.24.34.207',
'172.24.34.208',
'172.24.34.209',
'172.24.34.210',
'172.24.34.211',
'172.24.34.212',
'172.24.34.213',
'172.24.34.214',
'172.24.34.215',
'172.24.34.216',
'172.24.34.3',
'172.24.34.4',
'172.24.34.5',
'172.24.34.6',
'172.24.34.65',
'172.24.34.66',
'172.24.34.67',
'172.24.34.68',
'172.24.34.69',
'172.24.34.7',
'172.24.34.70',
'172.24.34.71',
'172.24.34.72',
'172.24.34.74',
'172.24.34.75',
'172.24.34.76',
'172.24.34.77',
'172.24.34.78',
'172.24.34.79',
'172.24.34.8',
'172.24.34.9',
'172.24.35.1',
'172.24.35.10',
'172.24.35.11',
'172.24.35.12',
'172.24.35.134',
'172.24.35.135',
'172.24.35.136',
'172.24.35.14',
'172.24.35.140',
'172.24.35.142',
'172.24.35.143',
'172.24.35.144',
'172.24.35.145',
'172.24.35.148',
'172.24.35.15',
'172.24.35.151',
'172.24.35.155',
'172.24.35.156',
'172.24.35.157',
'172.24.35.17',
'172.24.35.18',
'172.24.35.19',
'172.24.35.193',
'172.24.35.194',
'172.24.35.198',
'172.24.35.199',
'172.24.35.2',
'172.24.35.200',
'172.24.35.201',
'172.24.35.202',
'172.24.35.203',
'172.24.35.204',
'172.24.35.205',
'172.24.35.206',
'172.24.35.207',
'172.24.35.22',
'172.24.35.24',
'172.24.35.27',
'172.24.35.28',
'172.24.35.29',
'172.24.35.3',
'172.24.35.30',
'172.24.35.31',
'172.24.35.32',
'172.24.35.33',
'172.24.35.34',
'172.24.35.35',
'172.24.35.36',
'172.24.35.37',
'172.24.35.4',
'172.24.35.5',
'172.24.35.6',
'172.24.35.65',
'172.24.35.66',
'172.24.35.67',
'172.24.35.68',
'172.24.35.7',
'172.24.35.71',
'172.24.35.72',
'172.24.35.73',
'172.24.35.74',
'172.24.35.75',
'172.24.35.8',
'172.24.35.9',
'172.24.36.1',
'172.24.36.10',
'172.24.36.11',
'172.24.36.129',
'172.24.36.130',
'172.24.36.134',
'172.24.36.136',
'172.24.36.14',
'172.24.36.143',
'172.24.36.144',
'172.24.36.145',
'172.24.36.147',
'172.24.36.148',
'172.24.36.149',
'172.24.36.15',
'172.24.36.152',
'172.24.36.153',
'172.24.36.154',
'172.24.36.156',
'172.24.36.158',
'172.24.36.16',
'172.24.36.17',
'172.24.36.18',
'172.24.36.193',
'172.24.36.195',
'172.24.36.196',
'172.24.36.197',
'172.24.36.198',
'172.24.36.199',
'172.24.36.2',
'172.24.36.200',
'172.24.36.201',
'172.24.36.202',
'172.24.36.203',
'172.24.36.204',
'172.24.36.205',
'172.24.36.207',
'172.24.36.209',
'172.24.36.211',
'172.24.36.212',
'172.24.36.214',
'172.24.36.215',
'172.24.36.216',
'172.24.36.217',
'172.24.36.218',
'172.24.36.219',
'172.24.36.4',
'172.24.36.5',
'172.24.36.65',
'172.24.36.66',
'172.24.36.67',
'172.24.36.68',
'172.24.36.70',
'172.24.36.72',
'172.24.36.73',
'172.24.36.74',
'172.24.36.77',
'172.24.36.78',
'172.24.36.79',
'172.24.36.81',
'172.24.36.82',
'172.24.36.84',
'172.24.36.85',
'172.24.36.86',
'172.24.36.87',
'172.24.36.88',
'172.24.36.89',
'172.24.36.9',
'172.24.36.90',
'172.24.36.91',
'172.24.36.92',
'172.24.37.11',
'172.24.37.12',
'172.24.37.129',
'172.24.37.130',
'172.24.37.131',
'172.24.37.132',
'172.24.37.133',
'172.24.37.134',
'172.24.37.135',
'172.24.37.136',
'172.24.37.137',
'172.24.37.138',
'172.24.37.139',
'172.24.37.140',
'172.24.37.141',
'172.24.37.142',
'172.24.37.143',
'172.24.37.144',
'172.24.37.145',
'172.24.37.146',
'172.24.37.147',
'172.24.37.148',
'172.24.37.149',
'172.24.37.150',
'172.24.37.151',
'172.24.37.152',
'172.24.37.153',
'172.24.37.154',
'172.24.37.155',
'172.24.37.156',
'172.24.37.158',
'172.24.37.159',
'172.24.37.16',
'172.24.37.193',
'172.24.37.194',
'172.24.37.195',
'172.24.37.196',
'172.24.37.197',
'172.24.37.198',
'172.24.37.199',
'172.24.37.200',
'172.24.37.201',
'172.24.37.202',
'172.24.37.3',
'172.24.37.4',
'172.24.37.6',
'172.24.37.65',
'172.24.37.66',
'172.24.37.67',
'172.24.37.68',
'172.24.37.69',
'172.24.37.7',
'172.24.37.70',
'172.24.37.71',
'172.24.37.72',
'172.24.37.73',
'172.24.37.74',
'172.24.37.75',
'172.24.37.76',
'172.24.37.78',
'172.24.37.79',
'172.24.37.8',
'172.24.37.80',
'172.24.37.81',
'172.24.37.82',
'172.24.37.83',
'172.24.37.9',
'172.24.38.129',
'172.24.38.65',
'172.24.38.66',
'172.24.38.67',
'172.24.38.69',
'172.24.38.70',
'172.24.38.71',
'172.24.38.72',
'172.24.38.73',
'172.24.38.74',
'172.24.38.75',
'172.24.38.76',
'172.24.38.77',
'172.24.38.78',
'172.24.38.79',
'172.24.38.80',
'172.24.38.81',
'172.24.38.82',
'172.24.38.83',
'172.24.38.84',
'172.24.38.87',
'172.24.38.88',
'172.24.38.90',]
ipaddr = ['172.24.32.200']
iptv_unicast = [
    "1400",
    "1401",
    "1402",
    "1403",
    "1404",
    "1405",
    "1406",
    "1407",
    "1408",
    "1409",
    "1410",
    "1411",
    "1412",
    "1413",
    "1414",
    "1415",
    "1416",
    "1417",
    "1418",
    "1419",
    "1420",
    "1421",
    "1422",
    "1423",
    "1424",
    "1425",
    "1426",
    "1427",
    "1428",
    "1429",
    "1430",
    "1431",
    "1432",
    "1433",
    "1434",
    "1435",
    "1437",
    "1438",
    "1439",
    "1440",
    "1441",
    "1442",
    "1443",
    "1444",
    "1445",
    "1446",
    "1447",
    "1448",
    "1449",
    "1450",
    "1451",
    "1452",
    "1453",
    "1454",
    "1455",
    "1456",
    "1457",
    "1458",
    "1459",
    "1460",
    "1461",
    "1462",
    "1463",
    "1464",
    "1465",
    "1466",
    "1467",
    "1468",
    "1469",
    "1470",
    "1471",
    "1472",
    "1473",
    "1480",
    "1481",
    "1482",
    "1483",
    "1484",
    "1485",
    "1486",
    "1487",
    "1488",
    "1489",
    "1541",
    "1542",
    "1543",
    "1544",
    "1545",
    "1546",
    "1547",
    "1548",
    "1549",
    "1550",
    "1552",
    "1553",
    "1554",
    "1555",
    "1556",
    "1557",
    "1558",
    "1559",
    "1560",
    "1561",
    "1562",
    "1563",
    "1564",
    "1565",
    "1566",
    "1567",
    "1568",
    "1569",
    "1570",
    "1572",
    "1573",
    "1574",
    "1575",
    "1576",
    "1577",
    "1578",
    "1579",
    "1580",
    "1581",
    "1582",
    "1583",
    "1584",
    "1585",
    "1586",
    "1587",
    "1588",
    "1589",
    "1590",
    "1591",
    "1592",
    "1593",
    "1594",
    "1595",
    "1596",
    "1597",
    "1598",
    "1599",
]
askue_7606 = [
    "3028",
    "3102",
    "3104",
    "3105",
    "3106",
    "3107",
    "3108",
    "3109",
    "3112",
    "3113",
    "3115",
    "3118",
    "3120",
    "3122",
    "3123",
    "3124",
    "3125",
    "3126",
    "3130",
]
askue_er = ["3026"]
etth_mgmt_7606 = ["2157", "2271", "2279"]
etth_mgmt_er = [
    "2100",
    "2101",
    "2102",
    "2103",
    "2104",
    "2105",
    "2106",
    "2107",
    "2108",
    "2109",
    "2110",
    "2111",
    "2112",
    "2113",
    "2114",
    "2115",
    "2116",
    "2117",
    "2118",
    "2119",
    "2120",
    "2121",
    "2122",
    "2123",
    "2124",
    "2125",
    "2126",
    "2127",
    "2128",
    "2129",
    "2130",
    "2131",
    "2132",
    "2133",
    "2134",
    "2135",
    "2136",
    "2137",
    "2138",
    "2139",
    "2140",
    "2141",
    "2142",
    "2143",
    "2144",
    "2145",
    "2146",
    "2147",
    "2148",
    "2149",
    "2150",
    "2151",
    "2152",
    "2153",
    "2154",
    "2155",
    "2156",
    "2158",
    "2159",
    "2160",
    "2161",
    "2162",
    "2163",
    "2164",
    "2165",
    "2166",
    "2167",
    "2168",
    "2169",
    "2170",
    "2171",
    "2172",
    "2173",
    "2174",
    "2175",
    "2177",
    "2178",
    "2180",
    "2181",
    "2182",
    "2183",
    "2184",
    "2185",
    "2186",
    "2187",
    "2188",
    "2189",
    "2190",
    "2191",
    "2192",
    "2193",
    "2194",
    "2195",
    "2197",
    "2199",
    "2241",
    "2242",
    "2243",
    "2244",
    "2245",
    "2246",
    "2247",
    "2248",
    "2249",
    "2250",
    "2251",
    "2252",
    "2253",
    "2254",
    "2255",
    "2256",
    "2257",
    "2258",
    "2259",
    "2260",
    "2261",
    "2262",
    "2263",
    "2264",
    "2265",
    "2266",
    "2267",
    "2268",
    "2269",
    "2270",
    "2272",
    "2273",
    "2274",
    "2275",
    "2276",
    "2277",
    "2278",
    "2280",
    "2281",
    "2282",
    "2283",
    "2284",
    "2285",
    "2286",
    "2287",
    "2288",
    "2289",
    "2290",
    "2291",
    "2292",
    "2293",
    "2294",
    "2295",
    "2296",
    "2297",
    "2298",
    "2299",
]
sip = [
    "510",
    "512",
    "513",
    "515",
    "516",
    "517",
    "518",
    "519",
    "520",
    "521",
    "522",
    "523",
    "525",
    "526",
    "527",
    "528",
    "529",
    "530",
    "534",
    "535",
    "538",
    "539",
    "541",
    "544",
    "545",
    "547",
    "548",
    "549",
    "550",
    "551",
    "552",
    "553",
    "555",
    "556",
    "557",
    "558",
    "559",
    "560",
    "562",
    "566",
    "567",
    "568",
    "569",
    "570",
    "573",
    "574",
    "576",
    "577",
    "578",
    "580",
    "581",
    "582",
    "584",
    "586",
    "589",
    "533",
    "2099",
    "750",
    "751",
    "752",
    "753",
    "754",
    "755",
    "756",
    "757",
    "758",
    "759",
]

device_params = []
for ip in ip_addr_x:
    try:
        if ipaddress.ip_address(ip):
            devices = {
                "device_type": "huawei",
                "ip": ip,
                "username": user,
                "password": password,
                "conn_timeout": 10,
            }
            device_params.append(devices)
    except ValueError as error:
        print(error)
        sys.exit("ip address is incorrect!")


def take_device_conf(device_params):
    with open("backhaul_S93_fttx_main_x.csv", "w", newline="") as file:
        header = [
            "ftts_segment",
            "hostname",
            "mgmt_ip_addr",
            "xhaul_device",
            "port_on_xhaul",
            "port_to_xhaul",
            "port_to_fttx",
            "inner_vlan",
            "wifi_vlan",
            "stack_vlan",
            "port_to_fttx_descr",
            "backhaul_ring",
            "xhaul_ring",
            "migrated"
        ]
        writer = csv.writer(file, delimiter=",")
        writer.writerow(header)

        for device in device_params:
            with ConnectHandler(**device) as ssh:
                ssh.send_command("screen-length 0 temporary")
                info1 = ssh.send_command("dis int des | i MIN-54-ACC")
                port_to_xhaul = "".join(re.findall(r"(GE\d/\d/\d+) ", info1)).replace(
                    "GE", "GigabitEthernet"
                )
                info2 = ssh.send_command("dis cur | i sysname")
                match2 = re.findall(r"sysname (\d+\S+\n|\d+\S+)", info2)
                hostname = "".join(match2)
                info3 = ssh.send_command("dis int br | i up")
                xhaul_device = "hostname MIN-54-ACC-" + hostname.lower().lstrip(
                    "0"
                ).replace("_minsk_s9303", "")
                port_on_xhaul = "GigabitEthernet0/0/0/0"
                up_intf = re.findall(
                    r"(GigabitEthernet\d/\d/\d+|XGigabitEthernet\d/\d/\d+) .+up", info3
                )
                mgmt_ip_addr = device["ip"]
                rrpp = ssh.send_command("dis cur | i ring")
                backhaul_ring = ''.join(re.findall(r'ring (\d+) enable', rrpp))
                for intf in up_intf:
                    info4 = ssh.send_command("dis cur int {}".format(intf))
                    if "stack-vlan" in info4:
                        port_to_fttx = intf
                        port_to_fttx_descr = "".join(
                            re.findall(r"(description .+)", info4)
                        )
                        stack_vlan = re.findall(r"stack-vlan (\d+)", info4)
                        if len(stack_vlan) == 2:
                            if stack_vlan[0] == stack_vlan[1]:
                                stack_vlan = [int(j) for j in stack_vlan[0].split(' ')]
                            else:
                                stack_vlan = [int(j) for j in re.findall(r"stack-vlan (\d+)", info4)]
                        else:
                            stack_vlan = [int(j) for j in re.findall(r"stack-vlan (\d+)", info4)]
                        inner_vlan = []
                        if "stack-inner-vlan" in info4:
                            inner_vlan +=re.findall(
                                r"port vlan-stacking vlan (\d+|.+) stack-vlan", info4
                            )
                            inner_vlan += re.findall(r"stack-inner-vlan (\d+)", info4)
                        else:
                            inner_vlan = re.findall(
                                r"port vlan-stacking vlan (\d+|.+) stack-vlan", info4
                            )
                        inner_vlan = ', '.join(inner_vlan)
                        wifi_vlan = []
                        if '3000' in inner_vlan:
                                wifi_vlan.append('YES')
                        wifi_vlan = ''.join(wifi_vlan)
                        if "sep segment" in info4:
                            sep_segment = "".join(
                                map(
                                    "_".join,
                                    (
                                        re.findall(
                                            r"sep segment (\d+) edge (\S+)", info4
                                        )
                                    ),
                                )
                            )
                        else:
                            sep_segment = "absent"
                        xhaul_ring = None
                        migrated = None
                        writer.writerow(
                            [
                                sep_segment,
                                hostname,
                                mgmt_ip_addr,
                                xhaul_device,
                                port_on_xhaul,
                                port_to_xhaul,
                                port_to_fttx,
                                inner_vlan,
                                wifi_vlan,
                                stack_vlan,
                                port_to_fttx_descr,
                                backhaul_ring,
                                xhaul_ring,
                                migrated
                            ]
                        )
                    else:
                        continue


if __name__ == "__main__":
    take_device_conf(device_params)
